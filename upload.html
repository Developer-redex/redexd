<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙØ¹ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯ - Redex</title>
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">
    <link rel="stylesheet" href="../styles/globals.css">
    <link rel="stylesheet" href="../styles/components.css">
    <link rel="stylesheet" href="../styles/toast.css">
</head>

<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="container">
            <a href="../index.html" class="logo">
                <div class="logo-icon">R</div>
                <span>Redex</span>
            </a>

            <nav class="nav" id="nav">
                <ul class="nav-links">
                    <li><a href="../index.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="projects.html" class="nav-link">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹</a></li>
                    <li><a href="ask.html" class="nav-link">Ø§Ø³Ø£Ù„ Ø®Ø¨ÙŠØ±Ø§Ù‹</a></li>
                </ul>

                <div class="nav-buttons">
                    <button class="btn btn-secondary btn-sm" onclick="toggleTheme()" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹">
                        ğŸŒ—
                    </button>
                    <button class="lang-toggle" onclick="toggleLanguage()">
                        <span class="rtl-only">EN</span>
                        <span class="ltr-only">Ø¹Ø±Ø¨ÙŠ</span>
                    </button>
                    <a href="login.html" class="btn btn-secondary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                    <a href="register.html" class="btn btn-primary">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a>
                </div>
            </nav>

            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <section class="section">
        <div class="container" style="max-width: 800px;">
            <h1 class="text-center mb-xl">Ø±ÙØ¹ Ù…Ø´Ø±ÙˆØ¹ Ø¬Ø¯ÙŠØ¯</h1>

            <form id="upload-form" class="card">
                <div class="mb-md">
                    <label class="mb-sm" style="display: block; font-weight: bold;">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <input type="text" id="project-title" class="input-field" required placeholder="Ù…Ø«Ø§Ù„: ØªØ·Ø¨ÙŠÙ‚ Ù…Ù‡Ø§Ù…ÙŠ">
                </div>

                <div class="mb-md">
                    <label class="mb-sm" style="display: block; font-weight: bold;">Ø§Ø³Ù… Ø§Ù„Ù…Ø·ÙˆØ±</label>
                    <input type="text" id="project-author" class="input-field" required placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
                </div>

                <div class="mb-md">
                    <label class="mb-sm" style="display: block; font-weight: bold;">Ø§Ù„ÙØ¦Ø©</label>
                    <select id="project-category" class="input-field">
                        <option value="ğŸ“± Android">ØªØ·Ø¨ÙŠÙ‚ Android</option>
                        <option value="ğŸŒ Web">Ù…ÙˆÙ‚Ø¹ ÙˆÙŠØ¨</option>
                        <option value="ğŸ’» Desktop">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø³Ø·Ø­ Ù…ÙƒØªØ¨</option>
                        <option value="ğŸ® Game">Ù„Ø¹Ø¨Ø©</option>
                    </select>
                </div>

                <div class="mb-md">
                    <label class="mb-sm" style="display: block; font-weight: bold;">Ø§Ù„ÙˆØµÙ</label>
                    <textarea id="project-desc" class="input-field" rows="4" required
                        placeholder="ØµÙ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø¨Ø§Ø®ØªØµØ§Ø±..."></textarea>
                </div>

                <div class="mb-md">
                    <label class="mb-sm" style="display: block; font-weight: bold;">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„</label>
                    <input type="url" id="project-download" class="input-field" required
                        placeholder="https://example.com/download.zip">
                </div>

                <div class="mb-xl">
                    <label class="mb-sm" style="display: block; font-weight: bold;">ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                    <input type="file" id="project-image" class="input-field" accept="image/*" required
                        onchange="previewUploadImage(this)">
                    <div id="upload-preview-container" style="margin-top: 1rem; display: none;">
                        <img id="upload-preview" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø©"
                            style="max-width: 100%; height: 200px; object-fit: cover; border-radius: var(--border-radius-md); border: 2px dashed var(--color-primary-light);">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
            </form>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>Â© 2026 Ù…Ù†ØµØ© Redex Ù„Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            </div>
        </div>
    </footer>

    <script src="../scripts/api.js"></script>
    <script src="../scripts/main.js"></script>
    <script src="../scripts/link-checker.js"></script>
    <script>
        // Upload logic specific script
        document.getElementById('upload-form').addEventListener('submit', async function (e) {
            e.preventDefault();

            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';

            const title = document.getElementById('project-title').value;
            const author = document.getElementById('project-author').value;
            const category = document.getElementById('project-category').value;
            const desc = document.getElementById('project-desc').value;
            const downloadLink = document.getElementById('project-download').value;

            // Check link safety
            const safetyCheck = checkLinkSafety(downloadLink);

            if (!safetyCheck.safe) {
                const warnings = safetyCheck.warnings.join('\n');
                const proceed = confirm(`ØªØ­Ø°ÙŠØ± Ø£Ù…Ø§Ù†!\n\n${warnings}\n\nÙ…Ø¹Ø¯Ù„ Ø§Ù„Ø«Ù‚Ø©: ${safetyCheck.trustScore}%\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ Ø§Ù„Ø®Ø§ØµØ©ØŸ`);
                if (!proceed) return;
            }

            const fileInput = document.getElementById('project-image');

            // Process image
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    const project = {
                        id: Date.now(),
                        title: title,
                        author: author,
                        category: category,
                        description: desc,
                        downloadLink: downloadLink,
                        image: e.target.result, // Base64 image
                        date: new Date().toISOString(),
                        stats: {
                            likes: 0,
                            downloads: 0,
                            views: 0
                        },
                        status: 'pending', // Projects need admin approval
                        safetyCheck: safetyCheck // Store safety check results
                    };

                    // Save to localStorage
                    saveProject(project);
                    showToast('âœ… ØªÙ… Ø±ÙØ¹ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„ÙŠÙ‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.', 'success');
                    setTimeout(() => window.location.href = 'projects.html', 1500);
                };

                reader.readAsDataURL(fileInput.files[0]);
            }
        });

        function previewUploadImage(input) {
            const previewContainer = document.getElementById('upload-preview-container');
            const previewImage = document.getElementById('upload-preview');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImage.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
                reader.readAsDataURL(input.files[0]);
            } else {
                previewContainer.style.display = 'none';
            }
        }
    </script>
</body>

</html>